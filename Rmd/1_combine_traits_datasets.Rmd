---
title: "Constructing CCA phyloGWAS Eucalyptus dataset"
author: "Anne-Cecile Colin"
date: "10/06/2021"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
library(tidyverse)
library(devtools)
library(readr)
library(sp)
library(raster)
library(stats)
library(plyr)
library(dplyr)
library(readxl)
library(ggplot2)

setwd("C:/ACFolder/Research projects/phyloGWAS CurrencyCreek/R projects/EucsDroughtTraitsCoordination")

```

## Combining delta(13)C with the big species dataset with other traits

script to combine the previous dataset with species functional traits to the d13C dataset
the two datasets are combined according to the unique RowTree ID
then the dataset is filtered by unique RowTree# just in case.

```{r combine datasets part1}
d13C_data <- read.csv("../data/d13C_data.csv", header = TRUE)
nrow(d13C_data)
colnames(d13C_data)[1]<-"RowTree"
view(d13C_data)

species_dataset <- read.csv("../data/species_dataset.csv", header = TRUE)
view(species_dataset)
nrow(species_dataset)

full.df <- left_join(d13C_data, species_dataset, by = c("RowTree"))
nrow(full.df)
view(full.df)

u_full.df<-
  full.df %>% distinct(RowTree, .keep_all = T)
nrow(u_full.df)
view(u_full.df)

write.csv(u_full.df, "outputs/species_functional_traits.csv")

```

## Combining the resulting dataset with information from Worldclim and floral descriptions

```{r combine datasets part2}
u_full.df <- read.csv("../data/species_functional_traits.csv", header = TRUE)
nrow(u_full.df)
view(u_full.df)

species_dataset <- read.csv("../data/species_dataset.csv", header = TRUE)
view(species_dataset)
nrow(species_dataset)

full.df <- left_join(d13C_data, species_dataset, by = c("RowTree"))
nrow(full.df)
view(full.df)

u_full.df<-
  full.df %>% distinct(RowTree, .keep_all = T)
nrow(u_full.df)
view(u_full.df)

write.csv(u_full.df, "outputs/species_functional_traits.csv")

```


## Selecting/filtering the dataset for specific species/year

Because the whole d13C dataset contains also Victoria's species I refine here to exclude other species in Maidenaria or Eucalyptus sections.

``` {r filter dataset}

cca_filtered <- 
  u_full.df %>% 
  filter(Section %in% c("Exsertaria", "Adnataria"))
         
         # between(year, 1994, 2001))
view(cca_filtered)
str(cca_filtered)
```

```